server {
    listen       80; 
    rewrite http://olddriver.xyz/(.*)$ https://olddriver.xyz/$1 permanent;
        if (!-e $request_filename) {
                    rewrite ^(.*)$ /index.php$1 last;
        }
    }    
    
    server {
    
           listen      443 ssl;
     ssl_certificate      /etc/nginx/olddriver.crt;
        ssl_certificate_key  /etc/nginx/olddriver.key;
    
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers          ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA;
        ssl_prefer_server_ciphers on;
    server_name olddriver;
        access_log  /var/log/nginx/log/olddriver.log  main buffer=1m;
        root   /var/www/html;
        index  index.php index.html index.htm;
    
            if (!-e $request_filename) {
                        rewrite ^(.*)$ /index.php$1 last;
            }
        #error_page  404              /404.html;
        #error_page 500 502 503 504 =    /500.html;
    
    
        #屏蔽指定IP
        #deny 1.1.1.1;
     
    
    location ~ .*\.(css|js|ico|png)(.*) {
        expires 30d;
    }
    
       location  / {
        try_files $uri $uri/ /index.php?$args;
    }
    
    
    location ~ .*\.php(\/.*)*$ {
        fastcgi_pass 127.0.0.1:9000;
        #location ~ [^/]\.php(/|$) {
        fastcgi_split_path_info ^(.+?\.php)(/.*)$;
        #fastcgi_pass unix:/dev/shm/fpm-cgi.sock;
        fastcgi_param PATH_INFO $fastcgi_path_info; 
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
    }

    server {
    
           listen      443 ssl;
     ssl_certificate      /etc/nginx/qiandao.crt;
        ssl_certificate_key  /etc/nginx/qiandao.key;
    
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers          ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA;
        ssl_prefer_server_ciphers on;
    server_name qiandao.olddriver.xyz;
        access_log  /var/log/nginx/log/olddriver.log  main buffer=1m;
        root   /var/www/html/qiandao;
        index  index.php index.html index.htm;
    
            if (!-e $request_filename) {
                        rewrite ^(.*)$ /index.php$1 last;
            }
        #error_page  404              /404.html;
        #error_page 500 502 503 504 =    /500.html;
    
    
        #屏蔽指定IP
        #deny 1.1.1.1;
     
    
    location ~ .*\.(css|js|ico|png)(.*) {
        expires 30d;
    }
    
       location  / {
        try_files $uri $uri/ /index.php?$args;
    }
    
    
    location ~ .*\.php(\/.*)*$ {
        fastcgi_pass 127.0.0.1:9000;
        #location ~ [^/]\.php(/|$) {
        fastcgi_split_path_info ^(.+?\.php)(/.*)$;
        #fastcgi_pass unix:/dev/shm/fpm-cgi.sock;
        fastcgi_param PATH_INFO $fastcgi_path_info; 
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
    }

